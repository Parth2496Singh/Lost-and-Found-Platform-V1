{% extends "base.html" %}
{% block content %}

<div class="container py-5">

    <!-- ===================== ITEM DETAIL CARD ===================== -->
    <div id="detail-card" class="detail-card mx-auto">
        <h1 id="item-name" class="detail-title"></h1>

        <div class="detail-info">
            <p><strong>Item ID:</strong> <span id="item-id"></span></p>
            <p><strong>Location Lost:</strong> <span id="item-location"></span></p>
            <p><strong>Date Lost:</strong> <span id="item-date"></span></p>
            <p><strong>Description:</strong></p>
            <p id="item-description" class="detail-desc"></p>
        </div>

        <a href="/dashboard/" class="btn hero-btn mt-3">Back to Dashboard</a>
        <button id="view-matches-btn" class="btn hero-btn mt-3">View Matches</button>

        <!-- Container to display matches -->
        <div id="matches-container" class="mt-4"></div>
    </div>

</div>

<!-- ===================== SCRIPTS ===================== -->
<script>
const itemId = "{{ id }}";

// Fetch lost item details
fetch(`/api/lost-items/${itemId}/`)
    .then(res => res.json())
    .then(item => {
        document.getElementById("item-name").innerText = item.name;
        document.getElementById("item-id").innerText = item.id;
        document.getElementById("item-location").innerText = item.location;
        document.getElementById("item-date").innerText = item.date_lost;
        document.getElementById("item-description").innerText = item.description;
    })
    .catch(error => console.error("Error fetching detail:", error));

// Fetch matches on button click
document.getElementById("view-matches-btn").addEventListener("click", () => {
    const matchesContainer = document.getElementById("matches-container");

    fetch(`/api/lost-items/${itemId}/matches/`)
        .then(res => res.json())
        .then(data => {
            if(data.length === 0){
                matchesContainer.innerHTML = "<p>No matches found.</p>";
                return;
            }

            let html = `<h3>Top Matches</h3><div class="item-grid">`;
            data.forEach(item => {
                html += `
                    <div class="item-card">
                        <h4>${item.name}</h4>
                        <p><strong>Category:</strong> ${item.category}</p>
                        <p><strong>Location:</strong> ${item.location}</p>
                        <p><strong>Date Found:</strong> ${item.date_found}</p>
                        <p><strong>Description:</strong> ${item.description}</p>
                        <p><strong>Score:</strong> ${item.score.toFixed(2)}</p>
                    </div>`;
            });
            html += `</div>`;
            matchesContainer.innerHTML = html;
        })
        .catch(err => {
            matchesContainer.innerHTML = "<p>Error fetching matches.</p>";
            console.error(err);
        });
});
</script>

<!-- ===================== STYLES ===================== -->
<style>
.detail-card {
    max-width: 650px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 20px;
    padding: 30px;
    border: 1px solid rgba(0,255,247,0.4);
    box-shadow: 0 0 30px rgba(0,255,247,0.4);
    color: white;
}

.detail-title {
    color: #00fff7;
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 20px;
}

.detail-info p {
    font-size: 1.1rem;
    margin-bottom: 10px;
}

.detail-desc {
    background: rgba(0,0,0,0.4);
    padding: 12px;
    border-radius: 10px;
    border-left: 3px solid #00fff7;
}

/* Matches Grid */
.item-grid {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin-top: 10px;
}

.item-card {
    width: 260px;
    background: rgba(255,255,255,0.05);
    padding: 20px;
    border-radius: 20px;
    border: 1px solid rgba(0,255,247,0.3);
    color:#fff;
    box-shadow:0 0 20px rgba(0,255,247,0.2);
    transition:0.3s;
}

.item-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0 35px rgba(0,255,247,0.4);
}

#matches-container h3 {
    color: #00fff7;
    margin-bottom: 15px;
}
</style>

{% endblock %}
