{% extends "base.html" %}
{% block content %}

<!-- DASHBOARD TITLE -->
<div class="hero-section" style="height:auto; padding:50px 20px; text-align:center;">
    <h1 style="font-size:3rem; color:#00fff7;">Dashboard</h1>
    <p style="color:#ccc; font-size:1.1rem;">Complete overview of Lost & Found system activity</p>
</div>

<!-- ===================== STATS CARDS ===================== -->
<div class="container my-5">
    <div class="row g-4 text-center">

        <div class="col-md-3">
            <div class="dash-card">
                <h2 id="total-lost">0</h2>
                <p>Total Lost Items</p>
            </div>
        </div>

        <div class="col-md-3">
            <div class="dash-card">
                <h2 id="total-found">0</h2>
                <p>Total Found Items</p>
            </div>
        </div>

        <div class="col-md-3">
            <div class="dash-card">
                <h2 id="total-reunited">0</h2>
                <p>Items Reunited</p>
            </div>
        </div>

        <div class="col-md-3">
            <div class="dash-card">
                <h2 id="pending-verification">0</h2>
                <p>Pending Verifications</p>
            </div>
        </div>

    </div>
</div>

<!-- ===================== TABLES ===================== -->
<div class="container mt-5">

    <h2 class="section-title">All Lost Items</h2>
    <div style="overflow-x:auto; margin-bottom:40px;">
        <table id="lost-table" class="display" style="width:100%">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Item Name</th>
                    <th>Date Lost</th>
                    <th>Location</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <h2 class="section-title">All Found Items</h2>
    <div style="overflow-x:auto;">
        <table id="found-table" class="display" style="width:100%">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Item Name</th>
                    <th>Date Found</th>
                    <th>Location</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

</div>

<!-- ===================== DATA TABLES SCRIPT ===================== -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<script>
$(document).ready(function(){

    // ===== FETCH LOST ITEMS =====
    $.ajax({
        url: "/api/lost-items/",
        method: "GET",
        success: function(data){
            // handle paginated response
            let items = data.results || data;
            let count = data.count || items.length;

            $('#total-lost').text(count);

            let rows = '';
            items.forEach(item => {
                rows += `<tr>
                    <td>${item.id}</td>
                    <td>${item.name}</td>
                    <td>${item.date_lost}</td>
                    <td>${item.location}</td>
                    <td>${item.description}</td>
                    <td>${item.status || 'Pending'}</td>
                    <td><a href="/lost/${item.id}/" class="btn btn-sm hero-btn">View</a></td>
                </tr>`;
            });
            $('#lost-table tbody').html(rows);

            $('#lost-table').DataTable({
                pageLength: 10,
                responsive: true,
                scrollX: true,
                order: [[2, 'desc']] // order by date lost descending
            });
        }
    });

    // ===== FETCH FOUND ITEMS =====
    $.ajax({
        url: "/api/found-items/",
        method: "GET",
        success: function(data){
            let items = data.results || data;
            let count = data.count || items.length;

            $('#total-found').text(count);

            let rows = '';
            items.forEach(item => {
                rows += `<tr>
                    <td>${item.id}</td>
                    <td>${item.name}</td>
                    <td>${item.date_found}</td>
                    <td>${item.location}</td>
                    <td>${item.description}</td>
                    <td>${item.status || 'Pending'}</td>
                    <td><a href="/found/${item.id}/" class="btn btn-sm hero-btn">View</a></td>
                </tr>`;
            });
            $('#found-table tbody').html(rows);

            $('#found-table').DataTable({
                pageLength: 10,
                responsive: true,
                scrollX: true,
                order: [[2, 'desc']] // order by date found descending
            });
        }
    });

    // FUTURE PLACEHOLDERS
    $('#total-reunited').text(0);
    $('#pending-verification').text(0);
});
</script>

<!-- ===================== STYLES ===================== -->
<style>
.dash-card {
    background: rgba(255,255,255,0.05);
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 0 20px rgba(0,255,247,0.2);
    border: 1px solid rgba(0,255,247,0.3);
    color: #fff;
    transition: 0.3s;
}
.dash-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 0 35px rgba(0,255,247,0.6);
}

.section-title {
    color:#00fff7;
    font-weight:700;
    margin-bottom:15px;
}

table.dataTable {
    color: #fff;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(0,255,247,0.3);
}
table.dataTable thead th {
    color: #00fff7;
    border-bottom: 2px solid #00fff7;
}
table.dataTable tbody tr {
    background: rgba(0,0,0,0.2);
    transition: 0.3s;
}
table.dataTable tbody tr:hover {
    background: rgba(0,255,247,0.1);
    box-shadow: 0 0 15px rgba(0,255,247,0.3);
}
</style>

{% endblock %}
